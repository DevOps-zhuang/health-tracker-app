<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <title>Import Health Data</title>
    <style>
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .help-text {
            font-size: 0.9em;
            color: #666;
            margin-top: 2px;
        }
        .import-container {
            max-width: 800px;
            margin: 0 auto;
        }
        .format-options {
            margin-top: 20px;
            padding: 15px;
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .format-info {
            display: none;
            margin-top: 10px;
            padding: 10px;
            background-color: #e9ecef;
            border-radius: 4px;
        }
        
        .format-info.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="import-container">
        <h1>Import Health Data</h1>
        
        {% with messages = get_flashed_messages() %}
            {% if messages %}
                <div class="messages">
                    {% for message in messages %}
                        <div class="alert">{{ message }}</div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}
        
        <div class="instructions">
            <h2>Instructions</h2>
            <p>Upload a file containing health data to import into the system. Supported file formats:</p>
            <ul>
                <li><strong>CSV</strong>: Comma-separated values file</li>
                <li><strong>Excel</strong>: .xlsx or .xls spreadsheet</li>
                <li><strong>Text</strong>: Custom delimited text file</li>
                <li><strong>Image</strong>: JPG or PNG files containing blood pressure readings</li>
            </ul>
            <p>For CSV, Excel, and Text files, the file should contain the following columns:</p>
            <ul>
                <li><strong>timestamp</strong>: Date and time of the reading</li>
                <li><strong>systolic</strong>: Systolic blood pressure (100-200)</li>
                <li><strong>diastolic</strong>: Diastolic blood pressure (60-160)</li>
                <li><strong>heart_rate</strong>: Heart rate (50-200)</li>
                <li><strong>tags</strong>: Optional tags for the reading</li>
            </ul>
            <p>For Image files:</p>
            <ul>
                <li>The image should contain clear, readable numbers</li>
                <li>Blood pressure should be in the format "120/80"</li>
                <li>Heart rate (optional) should be clearly labeled (e.g., "HR: 75" or "75 BPM")</li>
            </ul>
        </div>
        
        <form action="/import" method="POST" enctype="multipart/form-data">
            <div class="form-group">
                <label for="file">Select File:</label>
                <input type="file" id="file" name="file" required accept=".csv,.xlsx,.xls,.txt,.jpg,.jpeg,.png">
            </div>
            
            <div class="format-options">
                <div class="form-group">
                    <label for="format">File Format:</label>
                    <select id="format" name="format">
                        <option value="auto">Auto-detect</option>
                        <option value="csv">CSV</option>
                        <option value="excel">Excel</option>
                        <option value="text">Text (Custom Delimiter)</option>
                        <option value="image">Image</option>
                    </select>
                </div>
                
                <div id="csv-text-options" class="format-info">
                    <div class="form-group" id="delimiter-group">
                        <label for="delimiter">Delimiter:</label>
                        <input type="text" id="delimiter" name="delimiter" value="," maxlength="1">
                        <p class="help-text">Character used to separate values (default: comma)</p>
                    </div>
                    
                    <div class="form-group">
                        <label for="date_format">Date Format:</label>
                        <input type="text" id="date_format" name="date_format" value="%Y-%m-%d %H:%M:%S">
                        <p class="help-text">Format: %Y (year), %m (month), %d (day), %H (hour), %M (minute), %S (second)</p>
                    </div>
                </div>

                <div id="image-options" class="format-info">
                    <p class="help-text">
                        For best results:<br>
                        - Ensure the image is clear and well-lit<br>
                        - Blood pressure numbers should be clearly visible<br>
                        - Numbers should be in the format "120/80"<br>
                        - Heart rate (if included) should be labeled as "HR" or "BPM"
                    </p>
                </div>
            </div>
            
            <button type="submit" class="btn-primary">Import Data</button>
            <a href="/" class="btn">Cancel</a>
        </form>
    </div>
    
    <script>
        // Show/hide format-specific options based on selection
        document.getElementById('format').addEventListener('change', function() {
            const format = this.value;
            const csvTextOptions = document.getElementById('csv-text-options');
            const imageOptions = document.getElementById('image-options');
            const delimiterGroup = document.getElementById('delimiter-group');
            
            // Hide all format-specific options first
            csvTextOptions.classList.remove('active');
            imageOptions.classList.remove('active');
            
            // Show relevant options based on selected format
            if (format === 'csv' || format === 'text') {
                csvTextOptions.classList.add('active');
                delimiterGroup.style.display = format === 'text' ? 'block' : 'none';
            } else if (format === 'image') {
                imageOptions.classList.add('active');
            }
        });
        
        // Initialize visibility on page load
        document.addEventListener('DOMContentLoaded', function() {
            const format = document.getElementById('format');
            format.dispatchEvent(new Event('change'));
        });
    </script>
</body>
</html>